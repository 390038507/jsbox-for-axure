(function(){"use strict";(function(){const axlibPath=getDeploy({gval:"AxLib",defaultUrl:"https://ax.minicg.com/axlib-v3.min.js"});main();function main(){if(window.AxJsBox){console.error("请先加载 axlib!");return}window.AxJsBox={name:"jsbox",version:"2.4.10",author:"wavef",contact:"wavef@live.com",instances:[],log:function(t,e=!0){const n="color:#06f;";console[e?"group":"groupCollapsed"]("%cJSBOX",n),console.log(t),console.groupEnd()}},$.fn.id=function(){if(arguments.length==0)return this.attr("id");arguments.length==1&&this.attr("id",arguments[0])},window.yepnope?inited():getAxLib(axlibPath,inited)}function inited(){let $jsboxes=$('div[class*="ax-jsbox"]'),repeaterIds=[];$.each($jsboxes,(t,e)=>{repeaterIds.push($(e).parent().parent().id())}),repeaterIds=[...new Set(repeaterIds)],$.each(repeaterIds,(idx,item)=>{let $rep=$("#"+item),repId=$rep.id(),rep=$axure(`#${repId}`);$rep.parent();let $jsbox=$rep.children("div").eq(0).children("div[class*=ax-jsbox]"),jsboxId=$jsbox.id(),$textArea=$jsbox.find("textarea");$rep.find("textarea");let textAreaId=$textArea.id(),$shape=$jsbox.children(`#${jsboxId}_div`),shapeId=$shape.id(),js=formatCode($textArea.val()),jsLines=js.split(`
`),$view=cloneNode($rep),viewId=$view.id();$view.insertAfter($rep),rep.getRepeaterDataOnce({format:"default"});let extraRawData=rep.getRepeaterDataDiff({format:"default"}),filesInExtra=getFileListFromExtraData(extraRawData)||[],filesInTextarea=getFileListFromTextArea(jsLines)||[],files=filesInExtra.concat(filesInTextarea);files=[...new Set(files)],$rep.hide(),addLoadingSvg($view);let formatInlineFunction=function(t){return t.toString().replace(/VIEW_ID/g,viewId).replace(/REP_ID/g,repId).replace(/JSBOX_ID/g,jsboxId).replace(/TEXTAREA_ID/g,textAreaId).replace(/  /g,"").trim()},clearAllTextareas=function(){$("#REP_ID").children("div").find('div[class*="ax-jsbox"]').children("textarea").html("")},getAllTextareas=function(){return $("#REP_ID").children("div").find('div[class*="ax-jsbox"]').children("textarea")},getTextarea=function(){return $axure("#TEXTAREA_ID")},getRepeater=function(){return $axure("#REP_ID")},getView=function(){return $axure("#VIEW_ID")},runScript=function(jsUrl){$.get(jsUrl,script=>eval(script))},setText=function(t){$("#TEXTAREA_ID").val(t)},getText=function(){return $("#TEXTAREA_ID").val()},setValues=function(t,e="/"){return $("#TEXTAREA_ID").val(e+t.join(e)),`[[ This.text.slice(This.text.split("${e}", 序号).length+1).split("${e}", 1) ]]`},emit=function(t,e){e=e||$axure("#JSBOX_ID"),t.toLowerCase()==="moved"?e.moveBy(0,0,{}):t==="selected"?e.selected(!0):t==="unselected"?e.selected(!1):t==="toggleSelect"&&e.selected(!e.selected())},showView=function(t,e){t=t||1,e=e||!0,$("#VIEW_ID").show().css({opacity:t,"pointer-events":e?"auto":"none"})},hideView=function(){$("#VIEW_ID").hide()},setViewStyle=function(t){t=t=="none"?{border:"none","background-color":"transparent"}:t,$("#VIEW_ID").css(t)},showLoading=function(){setTimeout(()=>{$("#VIEW_ID").children(".ax-loading").show()},0)},hideLoading=function(){setTimeout(()=>{$("#VIEW_ID").children(".ax-loading").fadeOut()},0)},appendHTML=function(t,e){e=e||$("#VIEW_ID"),e.append(t)},setHTML=function(t,e){e=e||$("#VIEW_ID"),e.html(t)},appendCSS=function(t){$("head").append("<style>"+t+"</style>")},getUserElements=function(){let t=[],e=$("#REP_ID").children("div").eq(0);return $.each(e.children(),(n,a)=>{a.className.includes("ax-jsbox")||t.push(a)}),t},showUserElements=function(){THIS.$view.append(THIS.getUserElements())},getDataOnce=function(t){return $axure("#REP_ID").getRepeaterDataOnce(t)},getExtraData=function(t){return $axure("#REP_ID").getRepeaterDataDiff(t)},getLatestData=function(t){return $axure("#REP_ID").getRepeaterData(t)},deleteData=function(t){$axure("#REP_ID").deleteRepeaterData(t),$axure("#REP_ID").refreshRepeater()},clearExtraData=function(){let t=$axure("#REP_ID").getRepeaterDataDiff();$axure("#REP_ID").deleteRepeaterData(t.length),$axure("#REP_ID").refreshRepeater()},clearData=function(){$axure("#REP_ID").clearRepeaterData(),$axure("#REP_ID").refreshRepeater()},getNode=function(t){let e,n;return t.$!==void 0?(e=t.$().attr("id"),n=$(`#${e}`).get(0)):t.jquery!==void 0?(e=t.attr("id"),n=$(`#${e}`).get(0)):t.tagName!==void 0&&(e=t.id,n=$(`#${e}`).get(0)),n},loadJS=function(t,e){let n=document.createElement("script");n.onload=e,n.src=t,$("head").appendChild(n)},loadCSS=function(t){$("head").append('<link text="text/css" href="'+t+'" rel="Stylesheet" />')},injectCode=`;const Loader = window.yepnope;let THIS = {
        files: ${`["${files.join('","')}"]`},
        vid: '${viewId}',
        view: $axure('#${viewId}'),
        $view: $axure('#${viewId}').$(),
        rid: '${repId}',
        repeater: $axure('#${repId}'),
        $repeater: $('#${repId}'),
        textarea: $axure('#${textAreaId}'),
        $textarea: $('#${textAreaId}'),
        $textareas: $('#${repId}').find('textarea'),
        jsbox: $axure('#${jsboxId}'),
        $jsbox: $axure('#${jsboxId}').$(),
        shape: $axure('#${shapeId}'),
        $shape: $axure('#${shapeId}').$(),
        size: { width:${$jsbox.width()}, height:${$jsbox.height()} },
        position: { x:${$jsbox.position().left}, y:${$jsbox.position().top} },
        clearAllTextareas: ${formatInlineFunction(clearAllTextareas)},
        getAllTextareas: ${formatInlineFunction(getAllTextareas)},
        getTextarea: ${formatInlineFunction(getTextarea)},
        getRepeater: ${formatInlineFunction(getRepeater)},
        getView: ${formatInlineFunction(getView)},
        setText: ${formatInlineFunction(setText)},
        getText: ${formatInlineFunction(getText)},
        setValues: ${formatInlineFunction(setValues)},
        emit: ${formatInlineFunction(emit)},
        getUserElements: ${formatInlineFunction(getUserElements)},
        showUserElements: ${formatInlineFunction(showUserElements)},
        getData: ${formatInlineFunction(getDataOnce)},
        getDataOnce: ${formatInlineFunction(getDataOnce)},
        getExtraData: ${formatInlineFunction(getExtraData)},
        getLatestData: ${formatInlineFunction(getLatestData)},
        deleteData: ${formatInlineFunction(deleteData)},
        clearExtraData: ${formatInlineFunction(clearExtraData)},
        clearData: ${formatInlineFunction(clearData)},
        appendHTML: ${formatInlineFunction(appendHTML)},
        setHTML: ${formatInlineFunction(setHTML)},
        appendCSS: ${formatInlineFunction(appendCSS)},
        showView: ${formatInlineFunction(showView)},
        hideView: ${formatInlineFunction(hideView)},
        setViewStyle: ${formatInlineFunction(setViewStyle)},
        showLoading: ${formatInlineFunction(showLoading)},
        hideLoading: ${formatInlineFunction(hideLoading)},
        runScript: ${formatInlineFunction(runScript)},
        getNode: ${formatInlineFunction(getNode)},
        loadJS: ${formatInlineFunction(loadJS)},
        loadCSS: ${formatInlineFunction(loadCSS)}
      };
      if(AxJsBox.instances){AxJsBox.instances.push(THIS);}
      else if(AxJsBox.elements){AxJsBox.elements.push(THIS);}
      `;injectCode=injectCode.replace(/  /g,"").replace(/\n/g,""),injectCode=`/* inject begin */
`+injectCode+`
/* inject end */

`,js=injectCode+js,js=`(function(){
${js}
}());`;let jsType=getScriptTypeFromTextArea(jsLines),jsOrder=getScriptOrderFromTextArea(jsLines);files.length===0?finalAppend($view,js,jsType,jsOrder):yepnope({load:files,complete:()=>{finalAppend($view,js,jsType,jsOrder)}})})}function finalAppend(t,e,n,a){t.append(`<script class="jsbox-script" type="${n}" ${a}>${e}<\/script>`),t.find(".ax-loading").hide()}function getAxLib(t,e=function(){}){$.getScript(t,e)}function getHostPath(){let t=window.location.href,e=t.split("/");return e.pop(),t=e.join("/"),t}function getDeploy(t){let{gval:e,defaultUrl:n}=t,a="";return $axure.internal(r=>{a=r.globalVariableProvider.getVariableValue(e)}),a===""&&(a=n),a.indexOf("{host}")>-1&&(a=a.replace("{host}",getHostPath())),a}function formatCode(t){let e="// @import ",n=t.split(`
`);n=n.map(r=>r.startsWith("//import")?r.replace("//import",e):r.startsWith("// import")?r.replace("// import",e):r.startsWith("//@import")?r.replace("//@import",e):r.startsWith("@import")?r.replace("@import",e):r);let a=n.join(`
`);return a=a.replace(/ /gi,"").replace(/  +/g," ").replace(/\n +/g,`
`).replace(/\n\n+/g,`
`),a}function addLoadingSvg(t,e){e=e||{color:"#D1D5DB",opacity:.2,scale:1.2,delay:0,dur:1,blending:"difference"};let n=`
      <svg xmlns="http://www.w3.org/2000/svg" width="38" height="38" viewBox="0 0 38 38" stroke="${e.color}" style="transform:scale(${e.scale});">
        <g fill="none" fill-rule="evenodd">
          <g transform="translate(1 1)" stroke-width="2">
            <circle stroke-opacity="${e.opacity}" cx="18" cy="18" r="18"/>
            <path d="M36 18c0-9.94-8.06-18-18-18">
              <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="${e.dur}s" repeatCount="indefinite"/>
            </path>
          </g>
        </g>
      </svg>
    `;return $("head").append(`
      <style>
        html, body { height: 100%; }
        .ax-loading { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: transparent; z-index: 9999; mix-blend-mode:${e.blending}; pointer-events:none; transform: scale(.5); }
        .ax-loading-svg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
      </style>
    `),$(t).append(`<div class="ax-loading"><div class="ax-loading-svg">${n}</div></div>`),n}function getFileListFromExtraData(t){let e=$axure.formatRepeaterData(t,{format:"row"});return e=Object.keys(e),e.filter(n=>n.substr(0,4)=="http")}function getFileListFromTextArea(t){let e=[];return t.forEach(n=>{let a="// @import ";n.startsWith(a)&&(n.includes("=")?e.push(n.replace(a,"").replace("=","").replace(/\s/g,"").replace(/\'/g,"").replace(/\"/g,"")):e.push(n.replace(a,"").replace(/\s/g,"")))}),e}function getScriptTypeFromTextArea(t){let e="text/javascript";return t.forEach(n=>{n==="//type module"?e="module":n.startsWith("//type")&&(n=n.replace(/\s/g,""),(n==='//type="module"'||n==="//type='module'"||n==="//type=module")&&(e="module"))}),e}function getScriptOrderFromTextArea(t){let e="";return t.forEach(n=>{n==="//defer"?e="defer":n==="//async"&&(e="async")}),e}function cloneNode(t){let e=t.clone();return e.children().remove(),e.data("label",""),e.removeClass("ax_default"),e.addClass(e.id()+"_clone"),e.id(e.id()+"_jsbox_view"),e.css({display:"flex",position:t.css("position"),left:t.css("left"),top:t.css("top"),width:t.css("width"),height:t.css("height"),"text-align":"left","border-radius":t.css("border-radius")}),e}})()})();
//# sourceMappingURL=axlib-jsbox-v2.min.js.map
